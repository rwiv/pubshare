generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model Account {
  id        Int     @id @default(autoincrement())
  email     String  @unique
  password  String
  certified Boolean @default(false)
  type      String  @default("MEMBER")

  FileComment     FileComment[]
  roles           Role[]
  fileAuthorities FileAuthority[]
}

model File {
  id                Int    @id @default(autoincrement())
  path              String @unique
  memberDefaultPerm String
  guestDefaultPerm  String

  fileComments    FileComment[]
  fileTags        FileTag[]
  filePolicies    FilePolicy[]
  fileAuthorities FileAuthority[]
}

model FileComment {
  id          Int    @id @default(autoincrement())
  fileId      Int
  createdById Int
  parentId    Int?
  content     String

  file      File          @relation(fields: [fileId], references: [id], onDelete: Cascade)
  createdBy Account       @relation(fields: [createdById], references: [id])
  parent    FileComment?  @relation("ParentChildren", fields: [parentId], references: [id])
  children  FileComment[] @relation("ParentChildren")
}

model Tag {
  id   Int    @id @default(autoincrement())
  name String @unique

  fileTags FileTag[]
}

model FileTag {
  id     Int @id @default(autoincrement())
  fileId Int
  tagId  Int

  file File @relation(fields: [fileId], references: [id])
  tag  Tag  @relation(fields: [tagId], references: [id])
}

model Policy {
  id   Int    @id @default(autoincrement())
  name String @unique

  roles        Role[]
  filePolicies FilePolicy[]
}

model Role {
  id        Int @id @default(autoincrement())
  accountId Int
  policyId  Int

  account Account @relation(fields: [accountId], references: [id])
  policy  Policy  @relation(fields: [policyId], references: [id])
}

model FilePolicy {
  id         Int    @id @default(autoincrement())
  fileId     Int
  policyId   Int
  permission String

  file   File   @relation(fields: [fileId], references: [id])
  policy Policy @relation(fields: [policyId], references: [id])
}

model FileAuthority {
  id         Int    @id @default(autoincrement())
  fileId     Int
  accountId  Int
  permission String

  file    File    @relation(fields: [fileId], references: [id])
  account Account @relation(fields: [accountId], references: [id])
}
